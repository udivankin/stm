<?php 
    $statuses = array('New','Started','Finished','Accepted','Rejected');
    
?>

<div class="modal" id="deleteCommentModal">
  <div class="modal-header">
    <a class="close" data-dismiss="modal">×</a>
    <h3>Delete confirmation</h3>
  </div>
  <div class="modal-body">
    <p>Are you sure you want to delete this comment?</p>
  </div>
  <div class="modal-footer">
    <a href="#" class="btn btn-primary" id="btnConfirmDeleteComment">Yes</a>
    <a href="#" class="btn btnModalClose">No, thanks</a>
  </div>
</div>

<div class="modal" id="deleteStoryModal">
  <div class="modal-header">
    <a class="close" data-dismiss="modal">×</a>
    <h3>Delete confirmation</h3>
  </div>
  <div class="modal-body">
    <p>Are you sure you want to delete this story?</p>
  </div>
  <div class="modal-footer">
    <a href="#" class="btn btn-primary" id="btnConfirmDeleteStory">Yes</a>
    <a href="#" class="btn btnModalClose">No, thanks</a>
  </div>
</div>

<div class="row">
    
    
    <div class="span2 well" style="padding: 8px 0;">
        <ul class="nav nav-list" id="storyFilters">
	    <li class="nav-header">Filter by officer:</li>
    <?php
        foreach ($this->officers as $officer) {
	    echo '<li><a class="filterByOfficer" storyofficer="'.$officer['officer'].'" href="javascript: return false;"><i class="icon-user"></i> '.$officer['officer'].'</a></li>';
	}
    ?>	
	    <li class="nav-header">Filter by status:</li>
	    <li><a href="javascript: return false;" class="filterByStatus" filterstatus="0"><i class="icon-tag"></i> <?php echo $statuses[0]; ?></a></li>
	    <li><a href="javascript: return false;" class="filterByStatus" filterstatus="1"><i class="icon-ok-sign"></i> <?php echo $statuses[1]; ?></a></li>
	    <li><a href="javascript: return false;" class="filterByStatus" filterstatus="2"><i class="icon-ok"></i> <?php echo $statuses[2]; ?></a></li>
	    <li><a href="javascript: return false;" class="filterByStatus" filterstatus="3"><i class="icon-lock"></i> <?php echo $statuses[3]; ?></a></li>
	    <li><a href="javascript: return false;" class="filterByStatus" filterstatus="4"><i class="icon-retweet"></i> <?php echo $statuses[4]; ?></a></li>
	</ul>
	<ul class="nav nav-list">
	    <li class="nav-header">Other options:</li>
	    <li><a href="javascript: return false;" class="resetFilters">Reset All Filters</a></li>
	    <li><a href="javascript: return false;" class="refreshStories">Refresh Stories List</a></li>	    
	</ul>	
    </div>
    
    
    
    <div class="span10">
<?php

    $this->myCustomTitle = "Stories list";

    foreach ($this->stories as $story) {
        
        $subtitle = 'Author: '.$story['content']['author'].' | Officer: '.$story['content']['officer'];
        $commentsCount = count($story['comments']);
        $currentStatusTitle = 'Mark as Started';
        
        echo '<div class="alert alert-info story" storyStatus="'.$story['content']['status'].'" storyOfficer="'.$story['content']['officer'].'" storyID="'.$story['content']['id'].'">';
        echo '<div class="storyBlock"><div class="storyBlockTitle"><h4><strong>['.$statuses[$story['content']['status']].'] #'.$story['content']['id'].'</strong> '.$story['content']['title'].'</h4></div>';
        echo '<p>'.$subtitle.'</p><p>Description: '.$story['content']['desc'].'</p>';
        
        ?>

        <div class="storyBlockRight">
            <div class="btn-group">
                <a class="btn" href="javascript: return false;"><?php echo $currentStatusTitle; ?></a>
                <a class="btn dropdown-toggle" data-toggle="dropdown" href="#">
                    <span class="caret"></span>
                </a>
                <ul class="dropdown-menu">
                    <li><a href="javascript: return false;">Mark as Finished</a></li>
                    <li class="divider"></li>
                    <li><a href="javascript: return false;"><i class="icon-lock"></i> Accept</a></li>
                    <li><a href="javascript: return false;"><i class="icon-retweet"></i> Reject</a></li>
		    <li class="divider"></li>
		    <li><a href="javascript: return false;" class="deleteStory" storyID="<?php echo $story['content']['id']; ?>"><i class="icon-remove"></i> Delete Story</a></li>
                </ul>
            </div>
             <a class="btn commentbutton tooltiped" data-original-title="Toggle comments (<?php echo $commentsCount; ?>)" data-toggle="button"><i class="icon-comment"></i></a>
        </div>
       
    </div>
    <div class="storyComments">
    <?php
        foreach ($story['comments'] as $comment) {
            echo '<pre id="cmt'.$comment['id'].'">'.$comment['author'].' wrote: '.$comment['text'].'<i class="icon-remove removeComment" title="Delete Comment" commentID="'.$comment['id'].'"></i></pre>';
        }
    
    ?>
        <textarea class="input-xlarge" id="commentTextarea<?php echo $story['content']['id']; ?>" rows="2"></textarea>
        <a class="btn addCommentBtn" storyID="<?php echo $story['content']['id']; ?>">Add comment</a>
    </div>
    
    

</div>

        <?php
    }

?>

<a class="btn btn-primary" id="storyAdd" href="javascript: return false;">Add new story</a>